<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Хогвартс Кликер</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative&display=swap');

    body {
      font-family: 'Cinzel Decorative', cursive, Arial, sans-serif;
      background: url('images/background.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
      padding: 20px;
      user-select: none;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h1, h2 {
      text-shadow: 2px 2px 4px #000;
      margin: 10px 0;
    }

    #counter {
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: bold;
      text-shadow: 2px 2px 5px #000;
    }

    #wand {
      width: 150px;
      margin: 30px auto 15px;
      cursor: pointer;
      transition: transform 0.15s ease;
      user-select: none;
      filter: drop-shadow(0 0 6px #f0e68c);
      background-color: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 10px;
      box-sizing: content-box;
      border: 2px solid #deb887;
    }

    #wand:active {
      transform: scale(1.1) rotate(-5deg);
      filter: drop-shadow(0 0 12px #ffd700);
    }

    nav {
      margin-top: auto;
      margin-bottom: 10px;
    }

    nav button {
      padding: 10px 25px;
      margin: 0 10px;
      font-size: 18px;
      background-color: #6a5acd;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 0 5px #483d8b;
      transition: background-color 0.3s ease;
    }

    nav button:hover, nav button.active {
      background-color: #7b68ee;
      box-shadow: 0 0 12px #8a2be2;
    }

    .tab {
      display: none;
      margin-top: 20px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px #222;
    }

    .tab.active {
      display: block;
    }

    /* Тестовые вопросы */
    #quiz p {
      font-size: 20px;
      margin: 15px 0 10px;
      text-shadow: 1px 1px 2px #000;
    }

    #quiz label {
      display: block;
      font-size: 18px;
      margin: 5px 0;
      cursor: pointer;
    }

    #quiz input[type="radio"] {
      margin-right: 10px;
      cursor: pointer;
    }

    #quiz button {
      margin-top: 15px;
      font-size: 18px;
      padding: 8px 20px;
    }

    /* Улучшения */
    .upgrade {
      background: rgba(255,255,255,0.1);
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 12px;
      box-shadow: inset 0 0 5px #555;
      transition: background-color 0.4s ease;
    }

    .upgrade:hover {
      background-color: rgba(255,255,255,0.25);
    }

    .upgrade button {
      float: right;
      background-color: #4b0082;
      border-radius: 10px;
      padding: 6px 14px;
      font-size: 16px;
      box-shadow: none;
    }

    .upgrade button:disabled {
      background-color: #999;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Таблица рейтинга */
    #leaderboardList {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 18px;
      max-height: 250px;
      overflow-y: auto;
      text-align: left;
    }

    #leaderboardList li {
      padding: 6px 12px;
      border-bottom: 1px solid #666;
    }
  </style>
</head>
<body>

  <h1>Хогвартс Кликер</h1>

  <!-- Тест перед выбором палочки -->
  <div id="quiz" class="tab active">
    <h2>Выберите свою палочку — пройдите тест</h2>
    <form id="quizForm">
      <div id="questionContainer"></div>
      <button type="submit">Ответить</button>
    </form>
  </div>

  <!-- Игра -->
  <div id="game" class="tab">
    <div id="counter">Галлеоны: 0</div>
    <img id="wand" src="" alt="Палочка героя" title="Кликни на палочку!" />
  </div>

  <!-- Улучшения -->
  <div id="upgrades" class="tab">
    <h2>Улучшения</h2>
    <div id="upgradesList"></div>
  </div>

  <!-- Рейтинг -->
  <div id="leaderboard" class="tab">
    <h2>Рейтинг игроков</h2>
    <ul id="leaderboardList"></ul>
    <button id="saveScoreBtn">Сохранить свой результат</button>
  </div>

  <nav>
    <button id="navGame" class="active">Игра</button>
    <button id="navUpgrades">Улучшения</button>
    <button id="navLeaderboard">Рейтинг</button>
  </nav>

  <script>
    // Палочки героев (названия файлов в папке images)
    const wands = {
      "harry": "wand_harry.png",
      "hermione": "wand_hermione.png",
      "ron": "wand_ron.png",
      "dumbledore": "wand_dumbledore.png",
      "snape": "wand_snape.png",
      "voldemort": "wand_voldemort.png",
      "gryffindor": "wand_gryffindor.png",
      "ravenclaw": "wand_ravenclaw.png",
      "hufflepuff": "wand_hufflepuff.png",
      "slytherin": "wand_slytherin.png"
    };

    // Вопросы теста
    const questions = [
      {
        question: "Какое качество для вас важнее всего?",
        answers: [
          { text: "Храбрость", wand: "gryffindor" },
          { text: "Мудрость", wand: "ravenclaw" },
          { text: "Верность", wand: "hufflepuff" },
          { text: "Амбиции", wand: "slytherin" }
        ]
      },
      {
        question: "Какой предмет вам нравится в школе?",
        answers: [
          { text: "Защита от тёмных искусств", wand: "harry" },
          { text: "Зельеварение", wand: "hermione" },
          { text: "Травология", wand: "ron" },
          { text: "Заклинания", wand: "dumbledore" }
        ]
      },
      {
        question: "Какой ваш любимый цвет?",
        answers: [
          { text: "Красный", wand: "harry" },
          { text: "Жёлтый", wand: "hufflepuff" },
          { text: "Синий", wand: "ravenclaw" },
          { text: "Зелёный", wand: "slytherin" }
        ]
      },
      {
        question: "Что для вас главное в дружбе?",
        answers: [
          { text: "Поддержка", wand: "ron" },
          { text: "Ум и знания", wand: "hermione" },
          { text: "Сила и защита", wand: "dumbledore" },
          { text: "Верность и смелость", wand: "harry" }
        ]
      },
      {
        question: "Как вы предпочитаете решать проблемы?",
        answers: [
          { text: "Прямо и решительно", wand: "harry" },
          { text: "Анализируя и планируя", wand: "hermione" },
          { text: "Обращаясь за помощью к друзьям", wand: "ron" },
          { text: "Используя хитрость", wand: "slytherin" }
        ]
      }
    ];

    let selectedWands = {};
    let currentQuestionIndex = 0;

    const quizDiv = document.getElementById('quiz');
    const questionContainer = document.getElementById('questionContainer');
    const quizForm = document.getElementById('quizForm');
    const gameDiv = document.getElementById('game');
    const wandImg = document.getElementById('wand');
    const counterEl = document.getElementById('counter');
    const upgradesDiv = document.getElementById('upgrades');
    const upgradesListEl = document.getElementById('upgradesList');
    const leaderboardDiv = document.getElementById('leaderboard');
    const leaderboardListEl = document.getElementById('leaderboardList');
    const saveScoreBtn = document.getElementById('saveScoreBtn');

    const navButtons = {
      game: document.getElementById('navGame'),
      upgrades: document.getElementById('navUpgrades'),
      leaderboard: document.getElementById('navLeaderboard')
    };

    let clicks = 0;
    let upgrades = [
      { id: 'clickPower', name: 'Сила клика', baseCost: 10, cost: 10, level: 0, effect: 1 },
      { id: 'autoClick', name: 'Автокликер', baseCost: 50, cost: 50, level: 0, effect: 1 }
    ];

    let clickPower = 1;
    let autoClickInterval = null;

    // Отображение вопроса
    function showQuestion(index) {
      const q = questions[index];
      questionContainer.innerHTML = `<p>${q.question}</p>`;
      q.answers.forEach((ans, i) => {
        const id = `q${index}_a${i}`;
        questionContainer.innerHTML += `
          <label for="${id}">
            <input type="radio" name="answer" id="${id}" value="${ans.wand}" required>
            ${ans.text}
          </label>`;
      });
    }

    // Подсчёт итоговой палочки
    function getResultWand() {
      const counts = {};
      for(let key in selectedWands) {
        const wand = selectedWands[key];
        counts[wand] = (counts[wand] || 0) + 1;
      }
      // Палочка с максимальным количеством ответов
      let maxCount = 0;
      let result = 'harry';
      for(let wand in counts) {
        if(counts[wand] > maxCount) {
          maxCount = counts[wand];
          result = wand;
        }
      }
      // Если несколько палочек равны — выберем первую (уже в result)
      return result;
    }

    quizForm.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(quizForm);
      const answer = formData.get('answer');
      selectedWands[currentQuestionIndex] = answer;
      currentQuestionIndex++;
      if(currentQuestionIndex < questions.length) {
        showQuestion(currentQuestionIndex);
      } else {
        // Конец теста
        const chosenWandKey = getResultWand();
        startGame(chosenWandKey);
      }
      quizForm.reset();
    });

    // Начинаем игру
    function startGame(wandKey) {
      quizDiv.classList.remove('active');
      gameDiv.classList.add('active');
      navButtons.game.classList.add('active');
      navButtons.upgrades.classList.remove('active');
      navButtons.leaderboard.classList.remove('active');

      chosenWand = wands[wandKey];
      wandImg.src = 'images/' + chosenWand;
      clicks = 0;
      clickPower = 1;
      upgrades.forEach(upg => {
        upg.level = 0;
        upg.cost = upg.baseCost;
      });
      saveProgress();
      updateClicksDisplay();
      renderUpgrades();

      // Запускаем автокликер, если куплен
      if(autoClickInterval) clearInterval(autoClickInterval);
      autoClickInterval = setInterval(() => {
        clicks += upgrades.find(u => u.id === 'autoClick').level * upgrades.find(u => u.id === 'autoClick').effect;
        updateClicksDisplay();
        saveProgress();
      }, 1000);
    }

    // Обновить счет
    function updateClicksDisplay() {
      counterEl.textContent = `Галлеоны: ${clicks}`;
    }

    // Клик по палочке
    wandImg.addEventListener('click', () => {
      clicks += clickPower;
      updateClicksDisplay();
      saveProgress();
    });

    // Сохраняем прогресс
    function saveProgress() {
      const progress = {
        clicks,
        chosenWand,
        upgrades
      };
      localStorage.setItem('hpProgress', JSON.stringify(progress));
    }

    // Загружаем прогресс
    function loadProgress() {
      const saved = localStorage.getItem('hpProgress');
      if(saved) {
        const progress = JSON.parse(saved);
        clicks = progress.clicks || 0;
        chosenWand = progress.chosenWand || wands.harry;
        upgrades = progress.upgrades || upgrades;
        wandImg.src = 'images/' + chosenWand;
        updateClicksDisplay();
        renderUpgrades();

        quizDiv.classList.remove('active');
        gameDiv.classList.add('active');
        navButtons.game.classList.add('active');
      } else {
        showQuestion(0);
      }
    }

    // Рендер улучшений
    function renderUpgrades() {
      upgradesListEl.innerHTML = '';
      upgrades.forEach(upg => {
        const canBuy = clicks >= upg.cost;
        const div = document.createElement('div');
        div.className = 'upgrade';
        div.innerHTML = `
          <span>${upg.name} (уровень: ${upg.level})</span>
          <button ${canBuy ? '' : 'disabled'} data-id="${upg.id}">Купить за ${upg.cost} галлеонов</button>
        `;
        upgradesListEl.appendChild(div);
      });
    }

    // Покупка улучшения
    upgradesListEl.addEventListener('click', e => {
      if(e.target.tagName === 'BUTTON') {
        const id = e.target.getAttribute('data-id');
        const upg = upgrades.find(u => u.id === id);
        if(clicks >= upg.cost) {
          clicks -= upg.cost;
          upg.level++;
          // Увеличение стоимости на 1.5 раза
          upg.cost = Math.floor(upg.baseCost * Math.pow(1.5, upg.level));
          if(id === 'clickPower') {
            clickPower = 1 + upg.level; // увеличиваем клик
          }
          if(id === 'autoClick') {
            // Эффект автокликера = уровень
            // Интервал уже запущен, просто увеличим значение добавляемое в setInterval
          }
          updateClicksDisplay();
          renderUpgrades();
          saveProgress();
        }
      }
    });

    // Навигация по вкладкам
    navButtons.game.addEventListener('click', () => {
      quizDiv.classList.remove('active');
      gameDiv.classList.add('active');
      upgradesDiv.classList.remove('active');
      leaderboardDiv.classList.remove('active');

      navButtons.game.classList.add('active');
      navButtons.upgrades.classList.remove('active');
      navButtons.leaderboard.classList.remove('active');
    });

    navButtons.upgrades.addEventListener('click', () => {
      quizDiv.classList.remove('active');
      gameDiv.classList.remove('active');
      upgradesDiv.classList.add('active');
      leaderboardDiv.classList.remove('active');

      navButtons.game.classList.remove('active');
      navButtons.upgrades.classList.add('active');
      navButtons.leaderboard.classList.remove('active');
    });

    navButtons.leaderboard.addEventListener('click', () => {
      quizDiv.classList.remove('active');
      gameDiv.classList.remove('active');
      upgradesDiv.classList.remove('active');
      leaderboardDiv.classList.add('active');

      navButtons.game.classList.remove('active');
      navButtons.upgrades.classList.remove('active');
      navButtons.leaderboard.classList.add('active');

      renderLeaderboard();
    });

    // Таблица лидеров (локальная симуляция)
    function renderLeaderboard() {
      let leaderboard = JSON.parse(localStorage.getItem('hpLeaderboard') || '[]');
      leaderboard.sort((a,b) => b.score - a.score);
      leaderboardListEl.innerHTML = '';
      leaderboard.forEach((player, i) => {
        const li = document.createElement('li');
        li.textContent = `${i+1}. ${player.name}: ${player.score} галлеонов`;
        leaderboardListEl.appendChild(li);
      });
    }

    saveScoreBtn.addEventListener('click', () => {
      const name = prompt('Введите ваше имя для рейтинга');
      if(!name) return alert('Имя обязательно');
      let leaderboard = JSON.parse(localStorage.getItem('hpLeaderboard') || '[]');
      leaderboard.push({name: name.trim(), score: clicks});
      localStorage.setItem('hpLeaderboard', JSON.stringify(leaderboard));
      alert('Результат сохранён!');
      renderLeaderboard();
    });

    // Загрузка прогресса или начало теста
    window.addEventListener('load', () => {
      loadProgress();
      if(!gameDiv.classList.contains('active')) {
        showQuestion(0);
      }
    });
  </script>

</body>
</html>
