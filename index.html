<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Хогвартс Кликер</title>
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0;
    font-family: 'MedievalSharp', cursive;
    background: url('images/background.png') no-repeat center center fixed;
    background-size: cover;
    color: #f5f1da;
    user-select: none;
  }
  #app {
    max-width: 480px;
    margin: auto;
    padding: 20px;
    text-align: center;
    background: rgba(0,0,0,0.6);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  h1 {
    margin-bottom: 15px;
    text-shadow: 2px 2px 5px #000;
  }
  /* Навигация */
  #nav {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  #nav button {
    background: #6a5acd;
    border: none;
    border-radius: 10px;
    color: white;
    margin: 0 8px;
    padding: 10px 18px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #nav button:hover, #nav button.active {
    background: #7b68ee;
  }
  /* Тест */
  .question {
    margin: 20px 0;
    font-size: 18px;
  }
  .answers {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }
  .answers button {
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #6a5acd;
    color: white;
    transition: background-color 0.3s ease;
  }
  .answers button:hover {
    background: #7b68ee;
  }
  /* Палочка */
  #wand {
    width: 150px;
    margin: 30px auto 15px;
    cursor: pointer;
    transition: transform 0.15s ease;
    user-select: none;
  }
  #wand:active {
    transform: scale(1.1) rotate(-10deg);
  }
  /* Счётчик */
  #counter {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 25px;
    text-shadow: 1px 1px 3px #000;
  }
  /* Улучшения */
  #upgrades-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .upgrade {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 12px;
  }
  .upgrade-title {
    font-size: 18px;
    margin-bottom: 8px;
  }
  .upgrade-info {
    margin-bottom: 10px;
  }
  .upgrade button {
    padding: 8px 15px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
    background: #6a5acd;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .upgrade button:disabled {
    background: #444;
    cursor: default;
  }
  .upgrade button:hover:not(:disabled) {
    background: #7b68ee;
  }
  /* Рейтинг */
  #leaderboard {
    text-align: left;
  }
  #leaderboard h2 {
    margin-bottom: 10px;
  }
  #leaderboard ol {
    padding-left: 20px;
  }
  /* Скрытие вкладок */
  .tab {
    display: none;
  }
  .tab.active {
    display: block;
  }
</style>
</head>
<body>
<div id="app">

  <h1>Хогвартс Кликер</h1>

  <!-- Навигация -->
  <div id="nav">
    <button id="tab-play-btn" class="active">Игра</button>
    <button id="tab-upgrades-btn">Улучшения</button>
    <button id="tab-leaderboard-btn">Рейтинг</button>
  </div>

  <!-- Вкладка: Тест -->
  <div id="tab-test" class="tab active">
    <div id="question-container"></div>
  </div>

  <!-- Вкладка: Игра -->
  <div id="tab-play" class="tab">
    <img id="wand" src="" alt="Палочка" title="Кликни на палочку!" />
    <div id="counter">Клики: 0</div>
  </div>

  <!-- Вкладка: Улучшения -->
  <div id="tab-upgrades" class="tab">
    <div id="upgrades-list"></div>
  </div>

  <!-- Вкладка: Рейтинг -->
  <div id="tab-leaderboard" class="tab">
    <h2>Топ игроков</h2>
    <ol id="leaderboard-list"></ol>
  </div>

</div>

<script>
  const questions = [
    {
      question: "Какое ваше любимое занятие в Хогвартсе?",
      answers: [
        { text: "Защита от тёмных искусств", wand: "wand_harry.png" },
        { text: "Зельеварение", wand: "wand_hermione.png" },
        { text: "Квиддич", wand: "wand_ron.png" },
        { text: "Изучение истории магии", wand: "wand_dumbledore.png" },
        { text: "Починка зелий и зельеварение", wand: "wand_snape.png" }
      ]
    },
    {
      question: "Кто ваш любимый факультет?",
      answers: [
        { text: "Гриффиндор", wand: "wand_gryffindor.png" },
        { text: "Когтевран", wand: "wand_ravenclaw.png" },
        { text: "Пуффендуй", wand: "wand_hufflepuff.png" },
        { text: "Слизерин", wand: "wand_slytherin.png" }
      ]
    },
    {
      question: "Какое животное вы бы выбрали в Хогвартсе?",
      answers: [
        { text: "Феникс", wand: "wand_dumbledore.png" },
        { text: "Сова", wand: "wand_hermione.png" },
        { text: "Крыса", wand: "wand_ron.png" },
        { text: "Змея", wand: "wand_voldemort.png" }
      ]
    },
    {
      question: "Какое качество вам ближе всего?",
      answers: [
        { text: "Смелость", wand: "wand_harry.png" },
        { text: "Ум", wand: "wand_hermione.png" },
        { text: "Верность", wand: "wand_ron.png" },
        { text: "Амбициозность", wand: "wand_slytherin.png" }
      ]
    },
    {
      question: "Что вы выберете в Хогвартсе?",
      answers: [
        { text: "Магия огня", wand: "wand_gryffindor.png" },
        { text: "Магия воды", wand: "wand_ravenclaw.png" },
        { text: "Магия земли", wand: "wand_hufflepuff.png" },
        { text: "Магия тьмы", wand: "wand_voldemort.png" }
      ]
    }
  ];

  const upgrades = [
    { id: 'autoClicker', name: "Авто-кликер", basePrice: 10, level: 0, effect: 1, desc: "Автоматически прибавляет 1 клик в секунду" },
    { id: 'doubleClick', name: "Двойной клик", basePrice: 25, level: 0, effect: 2, desc: "Каждый клик приносит в 2 раза больше очков" }
  ];

  // Хранение данных
  let currentQuestion = 0;
  let chosenWand = null;
  let clicks = 0;
  let clickMultiplier = 1;
  let autoClickInterval = null;

  // Элементы DOM
  const questionContainer = document.getElementById('question-container');
  const wandImg = document.getElementById('wand');
  const counterEl = document.getElementById('counter');
  const upgradesListEl = document.getElementById('upgrades-list');
  const leaderboardListEl = document.getElementById('leaderboard-list');

  // Навигация
  const tabs = {
    test: document.getElementById('tab-test'),
    play: document.getElementById('tab-play'),
    upgrades: document.getElementById('tab-upgrades'),
    leaderboard: document.getElementById('tab-leaderboard')
  };

  const navButtons = {
    play: document.getElementById('tab-play-btn'),
    upgrades: document.getElementById('tab-upgrades-btn'),
    leaderboard: document.getElementById('tab-leaderboard-btn')
  };

  function switchTab(name) {
    for (let t in tabs) {
      tabs[t].classList.remove('active');
      if(navButtons[t]) navButtons[t].classList.remove('active');
    }
    tabs[name].classList.add('active');
    if(navButtons[name]) navButtons[name].classList.add('active');
  }

  navButtons.play.onclick = () => switchTab('play');
  navButtons.upgrades.onclick = () => switchTab('upgrades');
  navButtons.leaderboard.onclick = () => {
    updateLeaderboard();
    switchTab('leaderboard');
  };

  // Загрузка прогресса
  function loadProgress() {
    const saved = JSON.parse(localStorage.getItem('hpGameSave'));
    if(saved) {
      clicks = saved.clicks || 0;
      chosenWand = saved.chosenWand || null;
      upgrades.forEach(u => {
        if(saved.upgrades && saved.upgrades[u.id] != null){
          u.level = saved.upgrades[u.id];
        }
      });
      clickMultiplier = 1;
      if(upgrades.find(u => u.id === 'doubleClick' && u.level > 0)) {
        clickMultiplier = 2;
      }
      updateClicksDisplay();
      if(chosenWand) {
        wandImg.src = 'images/' + chosenWand;
        switchTab('play');
      } else {
        switchTab('test');
        renderQuestion();
      }
    } else {
      switchTab('test');
      renderQuestion();
    }
  }

  // Сохранение прогресса
  function saveProgress() {
    const upgradesSave = {};
    upgrades.forEach(u => upgradesSave[u.id] = u.level);
    localStorage.setItem('hpGameSave', JSON.stringify({
      clicks,
      chosenWand,
      upgrades: upgradesSave
    }));
  }

  // Рендер вопроса теста
  function renderQuestion() {
    const q = questions[currentQuestion];
    questionContainer.innerHTML = `<div class="question">${q.question}</div><div class="answers"></div>`;
    const answersDiv = questionContainer.querySelector('.answers');
    q.answers.forEach((ans, i) => {
      const btn = document.createElement('button');
      btn.textContent = ans.text;
      btn.onclick = () => {
        // Сохраняем палочку
        chosenWand = ans.wand;
        // Переходим к следующему вопросу или завершаем тест
        currentQuestion++;
        if(currentQuestion >= questions.length) {
          // Тест окончен
          wandImg.src = 'images/' + chosenWand;
          switchTab('play');
          saveProgress();
        } else {
          renderQuestion();
        }
      };
      answersDiv.appendChild(btn);
    });
  }

  // Обновить отображение кликов
  function updateClicksDisplay() {
    counterEl.textContent = `Клики: ${clicks}`;
  }

  // Логика клика по палочке
  wandImg.addEventListener('click', () => {
    clicks += clickMultiplier;
    updateClicksDisplay();
    saveProgress();
  });

  // Рендер улучшений
  function renderUpgrades() {
    upgradesListEl.innerHTML = '';
    upgrades.forEach(upg => {
      const price = Math.floor(upg.basePrice * Math.pow(1.5, upg.level));
      const div = document.createElement('div');
      div.className = 'upgrade';
      div.innerHTML = `
        <div class="upgrade-title">${upg.name} (Уровень: ${upg.level})</div>
        <div class="upgrade-info">${upg.desc}</div>
        <button ${clicks < price ? 'disabled' : ''} data-id="${upg.id}">Купить за ${price} галлеонов</button>
      `;
      upgradesListEl.appendChild(div);
      div.querySelector('button').onclick = () => {
        if(clicks >= price) {
          clicks -= price;
          upg.level++;
          if(upg.id === 'doubleClick') clickMultiplier = 2;
          if(upg.id === 'autoClicker') {
            if(autoClickInterval) clearInterval(autoClickInterval);
            autoClickInterval = setInterval(() => {
              clicks += upg.effect * upg.level;
              updateClicksDisplay();
              saveProgress();
            }, 1000);
          }
          updateClicksDisplay();
          saveProgress();
          renderUpgrades();
        }
      };
    });
  }

  // Рейтинг (локальный)
  function updateLeaderboard() {
    // Хранение топа в localStorage
    let leaderboard = JSON.parse(localStorage.getItem('hpLeaderboard')) || [];

    // Текущий игрок
    let playerName = prompt("Введите ваше имя для рейтинга", "Маг");
    if(!playerName) playerName = "Маг";

    // Добавляем/обновляем игрока в рейтинге
    const existingIndex = leaderboard.findIndex(p => p.name === playerName);
    if(existingIndex >= 0) {
      if(clicks > leaderboard[existingIndex].score) {
        leaderboard[existingIndex].score = clicks;
      }
    } else {
      leaderboard.push({ name: playerName, score: clicks });
    }

    // Сортировка и обрезка до топ 10
    leaderboard.sort((a,b) => b.score - a.score);
    leaderboard = leaderboard.slice(0,10);

    localStorage.setItem('hpLeaderboard', JSON.stringify(leaderboard));

    // Отображаем
    leaderboardListEl.innerHTML = '';
    leaderboard.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.name} — ${p.score} кликов`;
      leaderboardListEl.appendChild(li);
    });
  }

  // Начинаем с загрузки прогресса
  loadProgress();

  // При переходе на вкладку Улучшения рендерим список
  navButtons.upgrades.addEventListener('click', renderUpgrades);

</script>
</body>
</html>
