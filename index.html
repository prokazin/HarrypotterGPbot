<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Harry Potter Wand Clicker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');
    body {
      font-family: 'MedievalSharp', cursive, Arial, sans-serif;
      background: url('images/background.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
      padding: 20px;
      user-select: none;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h1, h2 {
      text-shadow: 2px 2px 4px #000;
      margin-bottom: 10px;
    }
    #counter {
      font-size: 24px;
      margin: 20px 0;
      font-weight: bold;
      text-shadow: 1px 1px 3px #000;
    }
    #wand {
      width: 150px;
      cursor: pointer;
      user-select: none;
      /* Убрана анимация нажатия */
      /* transition: transform 0.1s ease; */
    }
    /*
    #wand:active {
      transform: scale(1.1) rotate(-5deg);
    }
    */
    #tabs {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .tab {
      padding: 10px 20px;
      background-color: #6a5acd;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.5);
      transition: background-color 0.3s ease;
    }
    .tab:hover, .tab.active {
      background-color: #7b68ee;
    }
    .tab-content {
      display: none;
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 15px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .tab-content.active {
      display: block;
    }
    button.upgrade-btn {
      width: 100%;
      margin: 8px 0;
      padding: 8px;
      background-color: #483d8b;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.upgrade-btn:hover {
      background-color: #5a4fcf;
    }
    #leaderboardList {
      list-style: none;
      padding-left: 10px;
      font-size: 18px;
    }
    #leaderboardList li {
      margin: 5px 0;
      text-shadow: 1px 1px 2px #000;
    }
    form label {
      display: block;
      margin: 8px 0 4px;
    }
    form input[type="radio"] {
      margin-right: 6px;
      cursor: pointer;
    }
    form button {
      margin-top: 12px;
      padding: 8px 15px;
      background-color: #6a5acd;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    form button:hover {
      background-color: #7b68ee;
    }
  </style>
</head>
<body>

  <h1>Хогвартс: Игра с волшебной палочкой</h1>

  <!-- Тест выбора палочки -->
  <div id="testDiv">
    <h2>Пройди тест и получи свою палочку!</h2>
    <form id="testForm">
      <label>1. Твое любимое занятие в Хогвартсе?</label>
      <input type="radio" name="q1" value="harry" required> Борьба с тёмными силами<br />
      <input type="radio" name="q1" value="hermione"> Учёба и чтение книг<br />
      <input type="radio" name="q1" value="ron"> Веселиться с друзьями<br />
      <input type="radio" name="q1" value="luna"> Изучать магию и природу<br />

      <label>2. Твоя любимая черта характера?</label>
      <input type="radio" name="q2" value="harry" required> Мужество<br />
      <input type="radio" name="q2" value="hermione"> Ум и сообразительность<br />
      <input type="radio" name="q2" value="ron"> Верность<br />
      <input type="radio" name="q2" value="luna"> Оригинальность<br />

      <label>3. Как ты решаешь проблему?</label>
      <input type="radio" name="q3" value="harry" required> Прямо и смело<br />
      <input type="radio" name="q3" value="hermione"> Анализирую и ищу знания<br />
      <input type="radio" name="q3" value="ron"> Обсуждаю с друзьями<br />
      <input type="radio" name="q3" value="luna"> Ищу нестандартные решения<br />

      <label>4. Твой любимый предмет?</label>
      <input type="radio" name="q4" value="harry" required> Защита от тёмных искусств<br />
      <input type="radio" name="q4" value="hermione"> Заклинания<br />
      <input type="radio" name="q4" value="ron"> Травология<br />
      <input type="radio" name="q4" value="luna"> Зельеварение<br />

      <label>5. Что ты выберешь в трудной ситуации?</label>
      <input type="radio" name="q5" value="harry" required> Быть лидером<br />
      <input type="radio" name="q5" value="hermione"> Подготовиться заранее<br />
      <input type="radio" name="q5" value="ron"> Полагаться на друзей<br />
      <input type="radio" name="q5" value="luna"> Действовать по интуиции<br />

      <button type="submit">Получить палочку</button>
    </form>
  </div>

  <!-- Игровая область -->
  <div id="gameArea" style="display:none;">
    <h2>Клики: <span id="counter">0</span></h2>
    <img id="wand" src="images/harry.png" alt="Волшебная палочка" />
    <div id="tabs">
      <div class="tab active" data-tab="upgradesTab">Улучшения</div>
      <div class="tab" data-tab="leaderboardTab">Рейтинг</div>
    </div>
    <div id="upgradesTab" class="tab-content active">
      <h3>Улучшения</h3>
      <div id="upgradesList"></div>
    </div>
    <div id="leaderboardTab" class="tab-content">
      <h3>Рейтинг лучших</h3>
      <ul id="leaderboardList"></ul>
    </div>
  </div>

<script>
(() => {
  // Элементы
  const testDiv = document.getElementById('testDiv');
  const testForm = document.getElementById('testForm');
  const gameArea = document.getElementById('gameArea');
  const counterSpan = document.getElementById('counter');
  const wandImg = document.getElementById('wand');
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');
  const upgradesList = document.getElementById('upgradesList');
  const leaderboardList = document.getElementById('leaderboardList');

  // Переменные игры
  let clicks = 0;
  let clickPower = 1;
  let selectedWand = null;

  // Палочки с изображениями
  const wands = {
    harry: 'images/harry.png',
    hermione: 'images/hermione.png',
    ron: 'images/ron.png',
    luna: 'images/luna.png'
  };

  // Улучшения
  const upgrades = [
    {id:'clickPower', name:'Сила клика +1', baseCost:10, level:0, cost:10, effect: () => { clickPower++; }},
    {id:'autoClicker', name:'Автокликер (+1 в сек)', baseCost:50, level:0, cost:50, effect: null}
  ];

  let autoClickerInterval = null;

  // Сохранение прогресса
  function saveProgress() {
    localStorage.setItem('hpClickerClicks', clicks);
    localStorage.setItem('hpClickerClickPower', clickPower);
    localStorage.setItem('hpClickerSelectedWand', selectedWand);
    localStorage.setItem('hpClickerUpgrades', JSON.stringify(upgrades));
  }

  // Загрузка прогресса
  function loadProgress() {
    const savedClicks = parseInt(localStorage.getItem('hpClickerClicks'));
    if(!isNaN(savedClicks)) clicks = savedClicks;

    const savedPower = parseInt(localStorage.getItem('hpClickerClickPower'));
    if(!isNaN(savedPower)) clickPower = savedPower;

    const savedWand = localStorage.getItem('hpClickerSelectedWand');
    if(savedWand && wands[savedWand]) selectedWand = savedWand;

    const savedUpgrades = localStorage.getItem('hpClickerUpgrades');
    if(savedUpgrades) {
      try {
        const upgs = JSON.parse(savedUpgrades);
        upgs.forEach(su => {
          let u = upgrades.find(up => up.id === su.id);
          if(u) {
            u.level = su.level;
            u.cost = su.cost;
          }
        });
      } catch(e){}
    }
  }

  // Обновление счетчика кликов
  function updateClicksDisplay() {
    counterSpan.textContent = clicks;
  }

  // Обновление палочки
  function updateWandImage() {
    if(selectedWand && wands[selectedWand]) {
      wandImg.src = wands[selectedWand];
    }
  }

  // Рендер апгрейдов
  function renderUpgrades() {
    upgradesList.innerHTML = '';
    upgrades.forEach(upg => {
      const btn = document.createElement('button');
      btn.textContent = `${upg.name} (Уровень: ${upg.level}) Цена: ${upg.cost} галлеонов`;
      btn.className = 'upgrade-btn';
      btn.disabled = clicks < upg.cost;
      btn.onclick = () => {
        if(clicks >= upg.cost) {
          clicks -= upg.cost;
          upg.level++;
          // Увеличиваем стоимость с каждым уровнем
          upg.cost = Math.floor(upg.baseCost * Math.pow(1.5, upg.level));
          if(upg.effect) upg.effect();
          if(upg.id === 'autoClicker' && upg.level === 1) {
            startAutoClicker();
          }
          updateClicksDisplay();
          renderUpgrades();
          saveProgress();
          renderLeaderboard();
        }
      };
      upgradesList.appendChild(btn);
    });
  }

  // Автокликер
  function startAutoClicker() {
    if(autoClickerInterval) clearInterval(autoClickerInterval);
    autoClickerInterval = setInterval(() => {
      clicks += upgrades.find(u => u.id === 'autoClicker').level;
      updateClicksDisplay();
      saveProgress();
      renderLeaderboard();
    }, 1000);
  }

  // Рендер рейтинга
  function renderLeaderboard() {
    const savedLeaders = JSON.parse(localStorage.getItem('hpClickerLeaderboard') || '[]');
    const playerName = 'Ты';
    let found = false;
    for(let i=0; i<savedLeaders.length; i++) {
      if(savedLeaders[i].name === playerName) {
        if(savedLeaders[i].score < clicks) {
          savedLeaders[i].score = clicks;
        }
        found = true;
        break;
      }
    }
    if(!found) {
      savedLeaders.push({name: playerName, score: clicks});
    }
    savedLeaders.sort((a,b) => b.score - a.score);
    const top = savedLeaders.slice(0, 10);
    localStorage.setItem('hpClickerLeaderboard', JSON.stringify(top));

    leaderboardList.innerHTML = '';
    top.forEach((item, i) => {
      const li = document.createElement('li');
      li.textContent = `${i+1}. ${item.name}: ${item.score}`;
      leaderboardList.appendChild(li);
    });
  }

  // Переключение вкладок
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const target = tab.getAttribute('data-tab');
      tabContents.forEach(tc => {
        if(tc.id === target) {
          tc.classList.add('active');
          tc.style.display = 'block';
        } else {
          tc.classList.remove('active');
          tc.style.display = 'none';
        }
      });
    });
  });

  // Клик по палочке
  wandImg.onclick = () => {
    clicks += clickPower;
    updateClicksDisplay();
    saveProgress();
    renderUpgrades();
    renderLeaderboard();
  };

  // Обработка теста
  testForm.onsubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(testForm);
    let scores = {harry: 0, hermione:0, ron:0, luna:0};
    for(const [key, value] of formData.entries()) {
      if(scores[value] !== undefined) scores[value]++;
    }
    let maxScore = 0;
    let chosen = 'harry';
    for(let k in scores) {
      if(scores[k] > maxScore) {
        maxScore = scores[k];
        chosen = k;
      }
    }
    selectedWand = chosen;
    clicks = 0;
    clickPower = 1;
    testDiv.style.display = 'none';
    gameArea.style.display = 'block';
    updateWandImage();
    updateClicksDisplay();
    renderUpgrades();
    renderLeaderboard();
    saveProgress();
  };

  // Загрузка прогресса при старте
  loadProgress();
  if(selectedWand) {
    testDiv.style.display = 'none';
    gameArea.style.display = 'block';
    updateWandImage();
    updateClicksDisplay();
    renderUpgrades();
    renderLeaderboard();
    if(upgrades.find(u => u.id === 'autoClicker' && u.level > 0)) {
      startAutoClicker();
    }
  }
})();
</script>

</body>
</html>
